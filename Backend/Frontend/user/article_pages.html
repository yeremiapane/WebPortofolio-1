<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Article Pages</title>

  <!-- Favicon -->
  <link rel="icon" href="assets/img/Designer.ico" type="image/png">

  <!-- CSS styles -->
  <link rel="stylesheet" href="assets/css/article_styles.css">
  <link rel="stylesheet" href="assets/css/navbar.css">

  <!-- Google Fonts (sesuaikan jika mau) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

<header class="header">
  <a href="#" class="header__logo">Maze.</a>
  <ion-icon name="menu-outline" class="header__toggle" id="nav-toggle"></ion-icon>

  <nav class="nav" id="nav-menu">
    <div class="nav__content bd-grid">
      <ion-icon name="close-outline" class="nav__close" id="nav-close"></ion-icon>
      <div class="nav__perfil">
        <div class="nav__img">
          <img src="assets/img/logo.png" alt="Maze-Logo">
        </div>
        <div>
          <a href="#" class="nav__name">Maze.</a>
          <span class="nav__profesion">Read Whole World!</span>
        </div>
      </div>

      <div class="nav__menu">
        <ul class="nav__list">
          <li class="nav__item"><a href="#" class="nav__link active">Home</a></li>
          <li class="nav__item"><a href="index.html" class="nav__link">About</a></li>
          <li class="nav__item"><a href="mailto:yeremiayosefanpane@hotmail.com" class="nav__link">Contact</a></li>
        </ul>
      </div>

      <div class="nav__social">
        <a href="https://www.linkedin.com/in/yeremia-yosefan-pane-74041921a/" class="nav__social-icon"><ion-icon name="logo-linkedin"></ion-icon></a>
        <a href="https://github.com/yeremiapane" class="nav__social-icon"><ion-icon name="logo-github"></ion-icon></a>
        <a href="#" class="nav__social-icon"><ion-icon name="mail-outline"></ion-icon></a>
      </div>
    </div>
  </nav>
</header>

<div id="container">
  <main id="mainContainer">
    <!-- Artikel akan dimasukkan via JavaScript -->
  </main>

  <aside>
    <section id="searchContainer">
      <h3>Search</h3>
      <form id="inputContainer">
        <input type="text" name="searchInput" id="searchInput" placeholder="Search the blog">
        <input type="submit" name="searchBtn" id="searchBtn" value="Search">
      </form>
    </section>

    <section id="categoriesContainer">
      <h3>Categories</h3>
      <ul id="categoriesUl">
        <!-- Popular categories dimasukkan via JS -->
      </ul>
    </section>

    <section id="tagsContainer">
      <h3>Tags</h3>
      <ul id="tagsUl">
        <!-- Popular tags dimasukkan via JS -->
      </ul>
    </section>
  </aside>
</div>

<footer>
  <h2>BLOG</h2>
  <p>LETS CREATE OUR IMAGINATION</p>
  <p>Â© Yeremia Yosefan Pane</p>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // ====================================
    // 1) Konfigurasi endpoint backend
    // ====================================
    // Ganti ini ke base URL backend Anda
    const BASE_URL = 'http://localhost:8080';

    // Ambil parameter dari URL (contoh: ?page=2&tag=xxx)
    const params = new URLSearchParams(window.location.search);
    const pageParam = parseInt(params.get('page') || '1');
    const tagParam = params.get('tag');
    const categoryParam = params.get('category');

    // Membangun URL fetch utama (/articles)
    // Kalau backend mendukung query param paging/limit, silakan tambahkan
    let articlesApiUrl = `${BASE_URL}/articles`;
    // Contoh: jika API Anda butuh ?page=..., dsb
    // articlesApiUrl += `?page=${pageParam}`;

    // (Sesuai log GIN, Anda punya /articles?search=&category=&tags=&limit=&page=...
    //  silakan tambahkan sendiri jika ingin filter. Contoh:
    // articlesApiUrl += \`?page=${pageParam}&category=${categoryParam || ''}&tags=${tagParam || ''}\`
    // dst.)

    // Variabel penampung artikel
    let allArticles = [];
    let currentIndex = 0;
    const articlesPerPage = 10; // Batas "Load More"
    const mainContainer = document.getElementById('mainContainer');

    // ====================================
    // 2) Ambil data artikel
    // ====================================
    fetch(articlesApiUrl)
            .then(response => {
              if (!response.ok) {
                throw new Error('Gagal mengambil data artikel, status: ' + response.status);
              }
              return response.json();
            })
            .then(articles => {
              // Simpan semua artikel
              allArticles = articles;
              // Tampilkan artikel awal (10 pertama)
              displayArticles();
              // Buat tombol Load More jika jumlah artikel > 10
              createLoadMoreButton();
            })
            .catch(err => {
              console.error('Error fetching articles:', err);
            });

    // ====================================
    // 3) Fungsi untuk menampilkan artikel
    // ====================================
    function displayArticles() {
      const slicedArticles = allArticles.slice(currentIndex, currentIndex + articlesPerPage);

      slicedArticles.forEach(article => {
        // Ambil properti dari JSON backend:
        // Berdasarkan contoh respons:
        // {
        //   "ID": 2,
        //   "Title": "ini adalah title 2",
        //   "Publisher": "semua",
        //   "MainImage": "uploads/article/20250116003945_Face (1).png",
        //   "Category": "beda",
        //   "Tags": "dua, duas",
        //   "Content": "ini adalah konten pertama2",
        //   "Likes": 0,
        //   "ReadingTime": 1,
        //   "CreatedAt": "...",
        //   "UpdatedAt": "..."
        //   ...
        // }

        const title = article.Title || 'Untitled';
        const image = article.MainImage ? `${BASE_URL}/${article.MainImage}` : 'assets/img/no-image.png';
        const publisher = article.Publisher || 'Unknown';
        const category = article.Category || 'Uncategorized';
        const readingTime = article.ReadingTime || 'N/A';
        const likes = article.Likes || 0;
        // Anda belum punya "comments" di respons -> asumsikan 0
        const comments = 0;
        // Cek apakah article di-update (jika UpdatedAt != CreatedAt)
        const isUpdated = article.UpdatedAt && article.UpdatedAt !== article.CreatedAt;

        // Tampilkan label "Updated" jika isUpdated = true
        const updatedMarkup = isUpdated
                ? `<span class="updated"><ion-icon name="alert-circle-outline"></ion-icon> <span class="semi-bold">Updated</span></span>`
                : '';

        // Teks ringkas? Silakan ambil sebagian Content
        const shortContent = article.Content
                ? article.Content.substring(0, 100) + '...'
                : 'No description';

        // Tags di respons adalah string "dua, duas". Kita bisa split koma:
        let tagsArray = [];
        if (article.Tags) {
          tagsArray = article.Tags.split(',').map(t => t.trim());
        }

        // Bangun markup artikel
        const articleElement = `
        <article class="post">
          <div class="image-container">
            <img src="${image}" alt="${title}">
          </div>
          <h2 class="title">${title}</h2>

          <div class="article-meta">
            <span class="reading-time">
              <ion-icon name="time-outline"></ion-icon> ${readingTime} min read
            </span>
            <span class="likes">
              <ion-icon name="heart-outline"></ion-icon> ${likes}
            </span>
            <span class="comments">
              <ion-icon name="chatbubble-outline"></ion-icon> ${comments}
            </span>
            ${updatedMarkup}
          </div>

          <div class="category">
            <ion-icon name="pricetag-outline"></ion-icon> ${category}
          </div>

          <p class="description">${shortContent}</p>
          <p class="author">By ${publisher}</p>

          <div class="tag-list">
            ${
                tagsArray.map(tag => `
                <span class="tag">
                  <ion-icon name="pricetag-outline"></ion-icon> ${tag}
                </span>
              `).join('')
        }
          </div>

          <!-- Contoh link ke detail -->
          <a class="more" href="/article/${article.ID}">Read More</a>
        </article>
      `;
        mainContainer.insertAdjacentHTML('beforeend', articleElement);
      });

      currentIndex += slicedArticles.length;
    }

    // ====================================
    // 4) Fungsi tombol Load More
    // ====================================
    function createLoadMoreButton() {
      if (document.getElementById('loadMoreBtn')) return; // Cegah dobel

      const loadMoreBtn = document.createElement('button');
      loadMoreBtn.id = 'loadMoreBtn';
      loadMoreBtn.textContent = 'Load More';
      // Sisipkan di bawah mainContainer
      mainContainer.insertAdjacentElement('afterend', loadMoreBtn);

      loadMoreBtn.addEventListener('click', () => {
        displayArticles();
        if (currentIndex >= allArticles.length) {
          loadMoreBtn.style.display = 'none';
        }
      });

      if (allArticles.length <= articlesPerPage) {
        loadMoreBtn.style.display = 'none';
      }
    }

    // ====================================
    // 5) Fetch popular-tags (opsional)
    //    Jika tidak ada route ini di backend,
    //    silakan hapus/komentari kode berikut.
    // ====================================
    // fetch(`${BASE_URL}/popular-tags`)
    //         .then(response => {
    //           if (!response.ok) {
    //             // Kalau 404, mungkin route belum tersedia
    //             // Boleh di-log / diabaikan
    //             throw new Error('No popular-tags route');
    //           }
    //           return response.json();
    //         })
    //         .then(tags => {
    //           const tagsUl = document.getElementById('tagsUl');
    //           tagsUl.innerHTML = '';
    //           tags.forEach(tag => {
    //             const tagElement = `<li><a href="?tag=${encodeURIComponent(tag)}">${tag}</a></li>`;
    //             tagsUl.insertAdjacentHTML('beforeend', tagElement);
    //           });
    //         })
    //         .catch(err => console.error('Error fetching tags:', err));

    // ====================================
    // 6) Fetch popular-categories (opsional)
    //    Jika tidak ada route ini di backend,
    //    silakan hapus/komentari kode berikut.
    // ====================================
    // fetch(`${BASE_URL}/popular-categories`)
    //         .then(response => {
    //           if (!response.ok) {
    //             throw new Error('No popular-categories route');
    //           }
    //           return response.json();
    //         })
    //         .then(categories => {
    //           const categoriesUl = document.getElementById('categoriesUl');
    //           categoriesUl.innerHTML = '';
    //           categories.forEach(ctg => {
    //             const categoryElement = `<li><a href="?category=${encodeURIComponent(ctg)}">${ctg}</a></li>`;
    //             categoriesUl.insertAdjacentHTML('beforeend', categoryElement);
    //           });
    //         })
    //         .catch(err => console.error('Error fetching categories:', err));
  });
</script>

<!-- Ionicons -->
<script src="https://unpkg.com/ionicons@5.1.2/dist/ionicons.js"></script>
<!-- Navbar JS (jika ada) -->
<script src="assets/js/navbar.js"></script>

</body>
</html>
