<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Portfolio</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="assets/upload-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="write-portfolio-container">
        <div class="header-section">
            <h2><i class="fas fa-plus-circle"></i> Create New Portfolio</h2>
            <p>Add a new project to your portfolio with detailed information</p>
        </div>

        <form id="writePortfolioForm" class="portfolio-form">
            <!-- Basic Information -->
            <div class="form-section">
                <h3><i class="fas fa-info-circle"></i> Basic Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="portfolio_title">Project Title *</label>
                        <input type="text" id="portfolio_title" name="title" required placeholder="Enter project title">
                    </div>
                    <div class="form-group">
                        <label for="portfolio_category">Category *</label>
                        <select id="portfolio_category" name="category" required>
                            <option value="">Select Category</option>
                            <option value="Development">Development</option>
                            <option value="Data Analytics">Data Analytics</option>
                            <option value="Data Engineer">Data Engineer</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="portfolio_description">Description *</label>
                        <textarea id="portfolio_description" name="description" required rows="3" placeholder="Brief description of the project"></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="portfolio_overview">Overview *</label>
                        <textarea id="portfolio_overview" name="overview" required rows="4" placeholder="Detailed overview of the project"></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="portfolio_project_time">Project Duration *</label>
                        <input type="text" id="portfolio_project_time" name="project_time" required placeholder="e.g., 3 months, 6 weeks">
                    </div>
                    <div class="form-group">
                        <label for="portfolio_hero_image">Hero Image *</label>
                        <div class="image-upload-container">
                            <div class="upload-area" id="heroUploadArea">
                                <div class="upload-content">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload or drag and drop</p>
                                    <p class="upload-hint">PNG, JPG, WebP up to 5MB</p>
                                </div>
                                <input type="file" id="portfolio_hero_image" name="hero_image" accept="image/*" required>
                            </div>
                            <div id="heroImagePreview" class="image-preview" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="portfolio_live_demo_url">Live Demo URL</label>
                        <input type="url" id="portfolio_live_demo_url" name="live_demo_url" placeholder="https://demo.example.com">
                    </div>
                    <div class="form-group">
                        <label for="portfolio_github_url">GitHub URL</label>
                        <input type="url" id="portfolio_github_url" name="github_url" placeholder="https://github.com/username/repo">
                    </div>
                </div>
            </div>

            <!-- Technology Stack -->
            <div class="form-section">
                <h3><i class="fas fa-code"></i> Technology Stack</h3>
                
                <!-- Frontend Technologies -->
                <div class="tech-stack-item">
                    <h4><i class="fas fa-desktop"></i> Frontend</h4>
                    <div id="frontendTech" class="tech-inputs-container">
                        <div class="tech-item">
                            <input type="text" name="frontend_name[]" placeholder="Technology name (e.g., React)">
                            <input type="text" name="frontend_version[]" placeholder="Version (e.g., 18.2)">
                            <input type="text" name="frontend_description[]" placeholder="Description">
                            <button type="button" class="btn-remove-small">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn-add-small" data-container="frontendTech" data-category="Frontend">
                        <i class="fas fa-plus"></i> Add Frontend Technology
                    </button>
                </div>

                <!-- Backend Technologies -->
                <div class="tech-stack-item">
                    <h4><i class="fas fa-server"></i> Backend</h4>
                    <div id="backendTech" class="tech-inputs-container">
                        <div class="tech-item">
                            <input type="text" name="backend_name[]" placeholder="Technology name (e.g., Golang)">
                            <input type="text" name="backend_version[]" placeholder="Version (e.g., 1.21)">
                            <input type="text" name="backend_description[]" placeholder="Description">
                            <button type="button" class="btn-remove-small">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn-add-small" data-container="backendTech" data-category="Backend">
                        <i class="fas fa-plus"></i> Add Backend Technology
                    </button>
                </div>

                <!-- Database Technologies -->
                <div class="tech-stack-item">
                    <h4><i class="fas fa-database"></i> Database</h4>
                    <div id="databaseTech" class="tech-inputs-container">
                        <div class="tech-item">
                            <input type="text" name="database_name[]" placeholder="Database name (e.g., MySQL)">
                            <input type="text" name="database_version[]" placeholder="Version (e.g., 8.0)">
                            <input type="text" name="database_description[]" placeholder="Description">
                            <button type="button" class="btn-remove-small">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn-add-small" data-container="databaseTech" data-category="Database">
                        <i class="fas fa-plus"></i> Add Database Technology
                    </button>
                </div>

                <!-- Tools & Platforms -->
                <div class="tech-stack-item">
                    <h4><i class="fas fa-tools"></i> Tools & Platforms</h4>
                    <div id="toolsTech" class="tech-inputs-container">
                        <div class="tech-item">
                            <input type="text" name="tools_name[]" placeholder="Tool name (e.g., Docker)">
                            <input type="text" name="tools_version[]" placeholder="Version (e.g., 20.10)">
                            <input type="text" name="tools_description[]" placeholder="Description">
                            <button type="button" class="btn-remove-small">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn-add-small" data-container="toolsTech" data-category="Tools">
                        <i class="fas fa-plus"></i> Add Tool/Platform
                    </button>
                </div>
            </div>

            <!-- Project Gallery -->
            <div class="form-section">
                <h3><i class="fas fa-images"></i> Project Gallery</h3>
                <p class="section-description">Add images to showcase your project</p>
                
                <div id="projectGallery" class="gallery-inputs-container">
                    <div class="gallery-item">
                        <div class="gallery-upload-area">
                            <div class="upload-content">
                                <i class="fas fa-image"></i>
                                <p>Upload Gallery Image</p>
                            </div>
                            <input type="file" name="gallery_image_file[]" accept="image/*" required>
                        </div>
                        <div class="gallery-image-preview"></div>
                        <div class="gallery-inputs">
                            <input type="text" name="gallery_title[]" placeholder="Image title">
                            <textarea name="gallery_description[]" rows="2" placeholder="Image description"></textarea>
                            <input type="number" name="gallery_order[]" placeholder="Order" min="1" value="1">
                </div>
                            <button type="button" class="btn-remove-small">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                <button type="button" class="btn-add-small" data-container="projectGallery" data-category="Gallery">
                    <i class="fas fa-plus"></i> Add Gallery Image
                    </button>
            </div>

            <!-- Custom Sections -->
            <div class="form-section">
                <h3><i class="fas fa-list-alt"></i> Custom Sections</h3>
                <p class="section-description">Add custom sections like Features, Challenges, Solutions, etc.</p>
                
                <div id="customSections" class="custom-sections-container">
                    <!-- Custom sections will be added here -->
                </div>

                <button type="button" id="addCustomSectionBtn" class="btn-add-small">
                    <i class="fas fa-plus"></i> Add Custom Section
                </button>
            </div>

            <!-- Project Stats -->
            <div class="form-section">
                <h3><i class="fas fa-chart-bar"></i> Project Statistics</h3>
                <p class="section-description">Add key project statistics (Duration, Team Size, etc.)</p>
                
                <div id="projectStats" class="stats-inputs-container">
                    <div class="stat-item">
                        <input type="text" name="stat_label[]" placeholder="Label (e.g., Duration)" required>
                        <input type="text" name="stat_value[]" placeholder="Value (e.g., 4 Months)" required>
                        <input type="text" name="stat_icon[]" placeholder="Icon class (e.g., fas fa-calendar)">
                        <input type="number" name="stat_order[]" placeholder="Order" min="1" value="1">
                            <button type="button" class="btn-remove-small">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                <button type="button" class="btn-add-small" data-container="projectStats" data-category="Stats">
                    <i class="fas fa-plus"></i> Add Project Stat
                    </button>
            </div>

            <!-- Project Info -->
            <div class="form-section">
                <h3><i class="fas fa-info"></i> Project Information</h3>
                <p class="section-description">Add additional project information (Client, Role, etc.)</p>
                
                <div id="projectInfo" class="info-inputs-container">
                    <div class="info-item">
                        <input type="text" name="info_label[]" placeholder="Label (e.g., Client)" required>
                        <input type="text" name="info_value[]" placeholder="Value (e.g., Company Name)" required>
                        <input type="number" name="info_order[]" placeholder="Order" min="1" value="1">
                        <button type="button" class="btn-remove-small">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <button type="button" class="btn-add-small" data-container="projectInfo" data-category="Info">
                    <i class="fas fa-plus"></i> Add Project Info
                    </button>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" id="cancelBtn" class="btn-cancel">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> Create Portfolio
                </button>
            </div>
        </form>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Creating portfolio...</p>
            </div>
        </div>
    </div>

    <!-- Custom Section Modal -->
    <div id="customSectionModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Custom Section</h3>
                <span class="close" id="closeCustomSectionModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="customSectionForm">
                    <div class="form-group">
                        <label for="sectionTitle">Section Title *</label>
                        <input type="text" id="sectionTitle" required placeholder="e.g., Features, Challenges, Solutions">
                    </div>
                    <div class="form-group">
                        <label for="sectionType">Section Type *</label>
                        <select id="sectionType" required>
                            <option value="">Select Type</option>
                            <option value="list">List</option>
                            <option value="gallery">Gallery</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sectionOrder">Order</label>
                        <input type="number" id="sectionOrder" min="1" value="1">
                    </div>
                    <div class="form-actions">
                        <button type="button" id="cancelCustomSection" class="btn-cancel">Cancel</button>
                        <button type="submit" class="btn-submit">Add Section</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing portfolio form...');
            
            // Custom section modal will be handled by index.js
            
            // Initialize form submission
            const form = document.getElementById('writePortfolioForm');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }

            // Initialize cancel button
            const cancelBtn = document.getElementById('cancelBtn');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to cancel? All unsaved changes will be lost.')) {
                        if (typeof loadContent === 'function') {
                            loadContent('/admin_dashboard_pages/dashboard.html', 'Dashboard');
                        } else {
                            window.location.href = '/admin/dashboard';
                        }
                    }
                });
            }

            // Initialize image upload functionality
            initializeImageUpload();
            
            // Dynamic buttons will be handled by index.js
            console.log('Portfolio form initialized - buttons handled by index.js');
        });

        // Custom section modal is now handled by index.js

        // Custom section functions are now handled by index.js

        function initializeImageUpload() {
            // Hero image upload
            const heroUploadArea = document.getElementById('heroUploadArea');
            const heroImageInput = document.getElementById('portfolio_hero_image');
            const heroPreview = document.getElementById('heroImagePreview');

            // Hero upload area click
            heroUploadArea.addEventListener('click', function() {
                heroImageInput.click();
            });

            // Hero drag and drop
            heroUploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });

            heroUploadArea.addEventListener('dragleave', function() {
                this.classList.remove('dragover');
            });

            heroUploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    heroImageInput.files = files;
                    handleHeroImagePreview(files[0]);
                }
            });

            // Hero file input change
            heroImageInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    handleHeroImagePreview(this.files[0]);
                }
            });

            // Gallery image upload handling
            initializeGalleryImageUpload();
        }

        function handleHeroImagePreview(file) {
            const heroPreview = document.getElementById('heroImagePreview');
            const heroUploadArea = document.getElementById('heroUploadArea');
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    heroPreview.innerHTML = `
                        <img src="${e.target.result}" alt="Hero Image Preview">
                        <p><i class="fas fa-check-circle" style="color: #10b981;"></i> ${file.name}</p>
                        <button type="button" onclick="clearHeroImage()" class="btn-remove-small" style="margin-top: 10px;">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    heroPreview.style.display = 'block';
                    heroUploadArea.classList.add('upload-success');
                };
                reader.readAsDataURL(file);
            }
        }

        function clearHeroImage() {
            const heroImageInput = document.getElementById('portfolio_hero_image');
            const heroPreview = document.getElementById('heroImagePreview');
            const heroUploadArea = document.getElementById('heroUploadArea');
            
            heroImageInput.value = '';
            heroPreview.style.display = 'none';
            heroUploadArea.classList.remove('upload-success');
        }

        function initializeGalleryImageUpload() {
            // Event delegation for gallery upload areas
            document.addEventListener('click', function(e) {
                if (e.target.closest('.gallery-upload-area')) {
                    const uploadArea = e.target.closest('.gallery-upload-area');
                    const fileInput = uploadArea.querySelector('input[type="file"]');
                    fileInput.click();
                }
            });

            // Event delegation for gallery file input change
            document.addEventListener('change', function(e) {
                if (e.target.type === 'file' && e.target.name === 'gallery_image_file[]') {
                    const galleryItem = e.target.closest('.gallery-item');
                    const uploadArea = galleryItem.querySelector('.gallery-upload-area');
                    const preview = galleryItem.querySelector('.gallery-image-preview');
                    
                    if (e.target.files && e.target.files[0]) {
                        const file = e.target.files[0];
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                preview.innerHTML = `
                                    <img src="${event.target.result}" alt="Gallery Preview">
                                    <p><i class="fas fa-check-circle" style="color: #10b981;"></i> ${file.name}</p>
                                `;
                                preview.style.display = 'block';
                                uploadArea.classList.add('upload-success');
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                }
            });

            // Gallery drag and drop
            document.addEventListener('dragover', function(e) {
                if (e.target.closest('.gallery-upload-area')) {
                    e.preventDefault();
                    e.target.closest('.gallery-upload-area').classList.add('dragover');
                }
            });

            document.addEventListener('dragleave', function(e) {
                if (e.target.closest('.gallery-upload-area')) {
                    e.target.closest('.gallery-upload-area').classList.remove('dragover');
                }
            });

            document.addEventListener('drop', function(e) {
                if (e.target.closest('.gallery-upload-area')) {
                    e.preventDefault();
                    const uploadArea = e.target.closest('.gallery-upload-area');
                    const fileInput = uploadArea.querySelector('input[type="file"]');
                    const files = e.dataTransfer.files;
                    
                    uploadArea.classList.remove('dragover');
                    
                    if (files.length > 0) {
                        fileInput.files = files;
                        // Trigger change event
                        const event = new Event('change', { bubbles: true });
                        fileInput.dispatchEvent(event);
                    }
                }
            });
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // Show loading overlay
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            try {
                // Handle image uploads first
                const imageUrls = await handleImageUploads();
                
                // Collect form data with image URLs
                const formData = collectPortfolioFormData(imageUrls);
            
            if (!formData) {
                document.getElementById('loadingOverlay').style.display = 'none';
                return;
            }
            
            // Submit to backend
                await submitPortfolioForm(formData);
            } catch (error) {
                document.getElementById('loadingOverlay').style.display = 'none';
                console.error('Error:', error);
                alert('Error creating portfolio: ' + error.message);
            }
        }

        async function handleImageUploads() {
            const imageUrls = {
                heroImage: null,
                galleryImages: []
            };

            // Handle hero image upload
            const heroImageFile = document.getElementById('portfolio_hero_image').files[0];
            if (heroImageFile) {
                try {
                    const heroUrl = await uploadHeroImage(heroImageFile);
                    imageUrls.heroImage = heroUrl;
                } catch (error) {
                    throw new Error('Failed to upload hero image: ' + error.message);
                }
            } else {
                throw new Error('Please select a hero image');
            }

            // Handle gallery image uploads
            const galleryItems = document.querySelectorAll('.gallery-item');
            for (let i = 0; i < galleryItems.length; i++) {
                const item = galleryItems[i];
                const fileInput = item.querySelector('input[type="file"]');
                
                if (fileInput && fileInput.files[0]) {
                    try {
                        const galleryUrl = await uploadGalleryImage(fileInput.files[0]);
                        imageUrls.galleryImages.push({
                            index: i,
                            url: galleryUrl
                        });
                    } catch (error) {
                        throw new Error(`Failed to upload gallery image ${i + 1}: ` + error.message);
                    }
                }
            }

            return imageUrls;
        }

        async function uploadHeroImage(file) {
            const formData = new FormData();
            formData.append('image', file);

            const response = await fetch('/api/admin/portfolios/upload/hero', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                },
                body: formData
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Failed to upload hero image');
            }

            const result = await response.json();
            return result.url;
        }

        async function uploadGalleryImage(file) {
            const formData = new FormData();
            formData.append('image', file);

            const response = await fetch('/api/admin/portfolios/upload/gallery', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                },
                body: formData
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Failed to upload gallery image');
            }

            const result = await response.json();
            return result.url;
        }

        function collectPortfolioFormData(imageUrls) {
            // Basic validation
            const title = document.getElementById('portfolio_title').value.trim();
            const category = document.getElementById('portfolio_category').value;
            const description = document.getElementById('portfolio_description').value.trim();
            const overview = document.getElementById('portfolio_overview').value.trim();
            const projectTime = document.getElementById('portfolio_project_time').value.trim();

            if (!title || !category || !description || !overview || !projectTime) {
                alert('Please fill all required fields');
                return null;
            }

            if (!imageUrls.heroImage) {
                alert('Please upload a hero image');
                return null;
            }

            const formData = {
                title: title,
                category: category,
                description: description,
                overview: overview,
                project_time: projectTime,
                image_url: imageUrls.heroImage,
                live_demo_url: document.getElementById('portfolio_live_demo_url').value.trim() || null,
                github_url: document.getElementById('portfolio_github_url').value.trim() || null,
                technology_stacks: collectTechnologyStacks(),
                project_gallery: collectProjectGallery(imageUrls.galleryImages),
                custom_sections: collectCustomSections(),
                project_stats: collectProjectStats(),
                project_info: collectProjectInfo()
            };

            return formData;
        }

        function collectTechnologyStacks() {
            const stacks = [];
            const categories = ['Frontend', 'Backend', 'Database', 'Tools'];
            
            categories.forEach(category => {
                const containerMap = {
                    'Frontend': 'frontendTech',
                    'Backend': 'backendTech', 
                    'Database': 'databaseTech',
                    'Tools': 'toolsTech'
                };
                
                const container = document.getElementById(containerMap[category]);
                const items = [];
                
                const techItems = container.querySelectorAll('.tech-item');
                techItems.forEach(item => {
                    const name = item.querySelector(`input[name="${category.toLowerCase()}_name[]"]`)?.value.trim();
                    const version = item.querySelector(`input[name="${category.toLowerCase()}_version[]"]`)?.value.trim();
                    const description = item.querySelector(`input[name="${category.toLowerCase()}_description[]"]`)?.value.trim();
                    
                    if (name) {
                        items.push({
                            name: name,
                            version: version || null,
                            description: description || null
                        });
                    }
                });
                
                if (items.length > 0) {
                    stacks.push({
                        category: category,
                        items: items
                    });
                }
            });
            
            return stacks;
        }

        function collectProjectGallery(uploadedImages = []) {
            const gallery = [];
            const galleryItems = document.querySelectorAll('#projectGallery .gallery-item');
            
            galleryItems.forEach((item, index) => {
                const title = item.querySelector('input[name="gallery_title[]"]')?.value.trim();
                const description = item.querySelector('textarea[name="gallery_description[]"]')?.value.trim();
                const order = parseInt(item.querySelector('input[name="gallery_order[]"]')?.value) || 1;
                
                // Find uploaded image URL for this index
                const uploadedImage = uploadedImages.find(img => img.index === index);
                
                if (uploadedImage) {
                    gallery.push({
                        image_url: uploadedImage.url,
                        title: title || null,
                        description: description || null,
                        order: order
                    });
                }
            });
            
            return gallery;
        }

        function collectCustomSections() {
            const sections = [];
            const sectionContainers = document.querySelectorAll('.custom-section-item');
            
            sectionContainers.forEach(container => {
                const sectionId = container.dataset.sectionId;
                const title = container.querySelector(`input[name="section_${sectionId}_title"]`)?.value;
                const sectionType = container.querySelector(`input[name="section_${sectionId}_type"]`)?.value;
                const order = parseInt(container.querySelector(`input[name="section_${sectionId}_order"]`)?.value) || 1;
                
                const items = [];
                const itemElements = container.querySelectorAll('.section-item');
                
                itemElements.forEach((item, index) => {
                    const itemTitle = item.querySelector(`input[name="section_${sectionId}_item_title[]"]`)?.value.trim();
                    const itemDescription = item.querySelector(`textarea[name="section_${sectionId}_item_description[]"]`)?.value.trim();
                    const itemImageUrl = item.querySelector(`input[name="section_${sectionId}_item_image_url[]"]`)?.value.trim();
                    const itemTag = item.querySelector(`input[name="section_${sectionId}_item_tag[]"]`)?.value.trim();
                    const itemOrder = parseInt(item.querySelector(`input[name="section_${sectionId}_item_order[]"]`)?.value) || index + 1;
                    
                    if (itemTitle && itemDescription) {
                        items.push({
                            title: itemTitle,
                            description: itemDescription,
                            image_url: itemImageUrl || null,
                            tag: itemTag || null,
                            order: itemOrder
                        });
                    }
                });
                
                if (title && items.length > 0) {
                    sections.push({
                        title: title,
                        section_type: sectionType,
                        order: order,
                        items: items
                    });
                }
            });
            
            return sections;
        }

        function collectProjectStats() {
            const stats = [];
            const statItems = document.querySelectorAll('#projectStats .stat-item');
            
            statItems.forEach(item => {
                const label = item.querySelector('input[name="stat_label[]"]')?.value.trim();
                const value = item.querySelector('input[name="stat_value[]"]')?.value.trim();
                const icon = item.querySelector('input[name="stat_icon[]"]')?.value.trim();
                const order = parseInt(item.querySelector('input[name="stat_order[]"]')?.value) || 1;
                
                if (label && value) {
                    stats.push({
                        label: label,
                            value: value,
                        icon: icon || null,
                        order: order
                        });
                    }
                });
                
            return stats;
        }

        function collectProjectInfo() {
            const info = [];
            const infoItems = document.querySelectorAll('#projectInfo .info-item');
            
            infoItems.forEach(item => {
                const label = item.querySelector('input[name="info_label[]"]')?.value.trim();
                const value = item.querySelector('input[name="info_value[]"]')?.value.trim();
                const order = parseInt(item.querySelector('input[name="info_order[]"]')?.value) || 1;
                
                if (label && value) {
                    info.push({
                        label: label,
                        value: value,
                        order: order
                    });
                }
            });
            
            return info;
        }

        async function submitPortfolioForm(formData) {
            const response = await fetch('/api/admin/portfolios', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                },
                body: JSON.stringify(formData)
            });

                if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Failed to create portfolio');
                }

            const result = await response.json();
                document.getElementById('loadingOverlay').style.display = 'none';
                alert('Portfolio created successfully!');
            
            // Redirect to dashboard
                if (typeof loadContent === 'function') {
                    loadContent('/admin_dashboard_pages/dashboard.html', 'Dashboard');
                } else {
                    window.location.href = '/admin/dashboard';
                }
        }

        // Dynamic buttons are now handled by index.js
        // All button functionality moved to centralized event handling
    </script>
</body>
</html> 